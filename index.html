<!DOCTYPE html>
<html lang="en">
<head>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/json2html/1.3.0/json2html.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.json2html/1.2.0/jquery.json2html.min.js"></script>

    <!-- Visualizer Core -->
    <link href="./css/visualizer.css" rel="stylesheet">
    <script src="./lib/visualizer.js"></script>

</head>

<body>
    <h1>Records</h1>
    <ul id="name-list"></ul>
    <div id="output"></div>
</body>


    
    <script>
// Function to visualize the fetched JSON data
function visualizeData(jsonData) {
    $(function() {
        // Ensure the document is fully loaded before creating the visualizer
        var _visualizer = new visualizer($("#output"));
        
        // Use the visualizer object to render the JSON data
        _visualizer.visualize(jsonData);
    });
}
// Function to fetch a single bin data by its bin ID
async function fetchAndDisplayNames() {
    const ids = [
        "",
        "66efc335ad19ca34f8aa88ae",
        "66efc2f1ad19ca34f8aa888c",
        "66efc2b2ad19ca34f8aa886f",
        "66efb4e7acd3cb34a888fd0b",
        "66efb287acd3cb34a888fbf4",
        "66efb209acd3cb34a888fbba"
    ];

    const baseUrl = "https://api.jsonbin.io/v3/c/66efaf65ad19ca34f8aa8148/bins/";
    const masterKey = "$2a$10$y9uBtJE8vwgFyfUEWmG2KejF8KLAg1vpe/WbcbQAC5zlhUJ1Obn6W";
    
    // To store the results from each fetch
    let mergedData = [];

    try {
        // Fetch each ID one by one
        for (const id of ids) {
            try {
                const response = await fetch(`${baseUrl}${id}`, {
                    headers: {
                        "X-Master-Key": masterKey
                    }
                });

                if (!response.ok) {
                    throw new Error(`Failed to fetch data for ID ${id}: ${response.statusText}`);
                }

                const data = await response.json();
                mergedData = mergedData.concat(data); // Append the current response to the mergedData

            } catch (error) {
                console.error(`Error fetching data for ID ${id}:`, error);
            }
        }
        
        // Once all fetches are done, display the merged data
        displayNames(mergedData);

    } catch (error) {
        console.error("Unexpected error:", error);
    }
}



// Function to fetch a list of names from the collection and display them
async function fetchAndDisplayNames() {
    const url = "https://api.jsonbin.io/v3/c/66efaf65ad19ca34f8aa8148/bins/66efc335ad19ca34f8aa88ae";
  
    try {
        const response = await fetch(url, {
            headers: {
                "X-Master-Key": "$2a$10$y9uBtJE8vwgFyfUEWmG2KejF8KLAg1vpe/WbcbQAC5zlhUJ1Obn6W"
            }
        });

        if (!response.ok) {
            throw new Error(`Failed to fetch name list: ${response.statusText}`);
        }

        const responseData = await response.json();

        // Call the function to display names from the fetched data
        displayNames(responseData);
    } catch (error) {
        console.error("Error fetching name list:", error);
    }
}

// Function to display names in a list
function displayNames(data) {
    const nameList = document.getElementById('name-list');
    nameList.innerHTML = ''; // Clear previous list if any

    // Iterate through each item in the data and create a list element
    data.forEach(item => {
        const li = document.createElement('li');
        li.textContent = item.snippetMeta.name;

        // Add click event listener to fetch the associated record data
        li.addEventListener('click', () => fetchRecord(item.record));

        // Append the list item to the list element
        nameList.appendChild(li);
    });
}

// Function to fetch and visualize the record data by its record ID
function fetchRecord(recordId) {
    fetchBinData(recordId);
}

// Call fetchAndDisplayNames on page load to populate the list
$(document).ready(function() {
    fetchAndDisplayNames();
});
</script>



</html>
